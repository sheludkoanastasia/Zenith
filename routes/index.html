<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Валидатор банковских карт</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #1e293b;
      --bg-input: #334155;
      --border-color: #475569;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --accent-primary: #8b5cf6;
      --accent-secondary: #a78bfa;
      --success: #10b981;
      --error: #ef4444;
      --gradient: linear-gradient(135deg, #8b5cf6, #06b6d4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 20%);
    }

    .card-validator-container {
      width: 100%;
      max-width: 480px;
    }

    .card-validator {
      background-color: var(--bg-card);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .card-validator::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient);
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1.5rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .description {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .card-preview {
      background: var(--gradient);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
    }

    .card-preview::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 200px;
      height: 200px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
    }

    .card-number-preview {
      font-size: 1.25rem;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .card-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .card-brands {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      padding: 1.5rem 0;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .brand-icon {
      height: 2.5rem;
      width: 3.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background-color: var(--bg-input);
      padding: 0.25rem;
      transition: all 0.3s ease;
      opacity: 0.4;
      filter: grayscale(1);
    }

    .brand-icon.active {
      opacity: 1;
      transform: scale(1.1);
      filter: grayscale(0);
      box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
    }

    .brand-icon img {
      height: 100%;
      width: 100%;
      object-fit: contain;
    }

    .input-area {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    input[type="text"] {
      width: 100%;
      padding: 1rem 1.25rem;
      background-color: var(--bg-input);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1.125rem;
      font-family: 'Inter', monospace;
      letter-spacing: 0.1em;
      transition: all 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    button {
      width: 100%;
      background: var(--gradient);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      padding: 1rem 1.25rem;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    #result {
      margin-top: 1.5rem;
      text-align: center;
      font-size: 1.125rem;
      font-weight: 600;
      min-height: 1.5em;
      padding: 1rem;
      border-radius: 12px;
      transition: all 0.3s;
    }

    #result.success {
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    #result.error {
      background-color: rgba(239, 68, 68, 0.1);
      color: var(--error);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .footer {
      text-align: center;
      margin-top: 2rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    @media (max-width: 480px) {
      .card-validator {
        padding: 1.5rem;
      }
      
      h1 {
        font-size: 1.75rem;
      }
      
      .card-preview {
        padding: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="card-validator-container">
    <div class="card-validator">
      <h1>Проверка карты</h1>
      
      <p class="description">Введите номер банковской карты для проверки её валидности и определения платёжной системы</p>
      
      <div class="card-preview">
        <div class="card-number-preview" id="cardPreview">4300 1111 2222 3331</div>
        <div class="card-details">
          <div>Имя держателя</div>
          <div>Срок действия</div>
        </div>
      </div>

      <div class="card-brands">
        <img src="img/visa.png" id="visa" class="brand-icon" title="Visa" alt="Visa">
        <img src="img/mc.png" id="mastercard" class="brand-icon" title="Mastercard" alt="Mastercard">
        <img src="img/visael.png" id="visaelectron" class="brand-icon" title="Visa Electron" alt="Visa Electron">
        <img src="img/maestro.png" id="maestro" class="brand-icon" title="Maestro" alt="Maestro">
        <img src="img/jcb.png" id="jcb" class="brand-icon" title="JCB" alt="JCB">
        <img src="img/mir.png" id="mir" class="brand-icon" title="MIR" alt="MIR">
      </div>

      <div class="input-area">
        <div class="input-group">
          <label for="cardNumber">Номер карты</label>
          <input type="text" id="cardNumber" placeholder="0000 0000 0000 0000" />
        </div>
        <button id="cardCheck" type="button">Проверить карту</button>
      </div>

      <div id="result"></div>
      
      <div class="footer">
        Проверка осуществляется по алгоритму Луна
      </div>
    </div>
  </div>

  <script>
    'use strict';

    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const cardNumberInput = document.getElementById('cardNumber');
        const checkButton = document.getElementById('cardCheck');
        const resultDiv = document.getElementById('result');
        const cardPreview = document.getElementById('cardPreview');
        const brandIcons = {
            visa: document.getElementById('visa'),
            mastercard: document.getElementById('mastercard'),
            visaelectron: document.getElementById('visaelectron'),
            maestro: document.getElementById('maestro'),
            jcb: document.getElementById('jcb'),
            mir: document.getElementById('mir'),
        };

        // --- Constants ---
        const CARD_BRANDS = [
            { id: 'visa', name: 'Visa', patterns: ['4'] },
            { id: 'mastercard', name: 'Mastercard', patterns: ['51', '52', '53', '54', '55', '2221', '2222', '2223', '2224', '2225', '2226', '2227', '2228', '2229', '223', '224', '225', '226', '227', '228', '229', '23', '24', '25', '26', '270', '271', '2720'] },
            { id: 'visaelectron', name: 'Visa Electron', patterns: ['4026', '417500', '4508', '4844', '4913', '4917'] },
            { id: 'maestro', name: 'Maestro', patterns: ['50', '56', '57', '58', '6'] },
            { id: 'jcb', name: 'JCB', patterns: ['3528', '3529', '353', '354', '355', '356', '357', '358'] },
            { id: 'mir', name: 'MIR', patterns: ['2200', '2201', '2202', '2203', '2204'] }
        ];

        // --- Utility Functions ---

        /**
         * Removes all non-digit characters from a string.
         * @param {string} s The input string.
         * @returns {string} The string with only digits.
         */
        const getDigitsOnly = (s) => s.replace(/\D/g, '');

        /**
         * Formats card number with spaces (e.g., 4300 1111 2222 3331).
         * @param {string} s The digits-only card number.
         * @returns {string} The formatted card number.
         */
        const formatCardNumber = (s) => s.replace(/(\d{4})/g, '$1 ').trim();

        /**
         * Validates a credit card number using the Luhn algorithm.
         * @param {string} cardNumber The card number as a string of digits.
         * @returns {boolean} True if the number is valid, false otherwise.
         */
        const luhnCheck = (cardNumber) => {
            if (!/^\d+$/.test(cardNumber)) {
                return false;
            }

            const digits = cardNumber.split('').map(Number);
            let sum = 0;
            let isSecond = false;

            for (let i = digits.length - 1; i >= 0; i--) {
                let digit = digits[i];
                if (isSecond) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                sum += digit;
                isSecond = !isSecond;
            }

            return sum > 0 && sum % 10 === 0;
        };

        /**
         * Detects the brand of a credit card based on its number.
         * @param {string} cardNumber The card number as a string of digits.
         * @returns {string} The detected card brand ID.
         */
        const detectCardBrand = (cardNumber) => {
            for (const brand of CARD_BRANDS) {
                for (const pattern of brand.patterns) {
                    if (cardNumber.startsWith(pattern)) {
                        return brand.id;
                    }
                }
            }
            return 'unknown';
        };
        
        /**
         * Updates the UI to highlight the detected card brand icon.
         * @param {string} detectedBrandId The ID of the brand to highlight.
         */
        const updateBrandHighlight = (detectedBrandId) => {
            Object.values(brandIcons).forEach(icon => {
                if (icon) icon.classList.remove('active');
            });

            const activeIcon = brandIcons[detectedBrandId];
            if (activeIcon) {
                activeIcon.classList.add('active');
            }
        };

        // --- Event Handlers ---

        const handleInputChange = () => {
            const digitsOnly = getDigitsOnly(cardNumberInput.value);
            
            // Limit length to prevent super long inputs
            const truncatedDigits = digitsOnly.slice(0, 19);

            // Update the input field with the formatted number
            const formattedNumber = formatCardNumber(truncatedDigits);
            cardNumberInput.value = formattedNumber;
            
            // Update card preview
            cardPreview.textContent = formattedNumber || '0000 0000 0000 0000';

            // Detect and highlight the brand
            const brandId = detectCardBrand(truncatedDigits);
            updateBrandHighlight(brandId);
            
            // Clear result on new input
            resultDiv.textContent = '';
            resultDiv.className = '';
        };
        
        const handleCheck = () => {
            const digitsOnly = getDigitsOnly(cardNumberInput.value);

            // Clear previous result
            resultDiv.textContent = '';
            resultDiv.className = '';

            if (digitsOnly.length < 13 || digitsOnly.length > 19) {
                resultDiv.textContent = 'Неверная длина номера карты.';
                resultDiv.classList.add('error');
                return;
            }

            if (luhnCheck(digitsOnly)) {
                const brand = CARD_BRANDS.find(b => b.id === detectCardBrand(digitsOnly));
                const brandName = brand ? brand.name : 'Unknown';
                resultDiv.textContent = `Карта валидна. Бренд: ${brandName}`;
                resultDiv.classList.add('success');
            } else {
                resultDiv.textContent = 'Номер карты невалиден (проверка Луна не пройдена).';
                resultDiv.classList.add('error');
            }
        };

        // --- Initialization ---

        const initialize = () => {
            cardNumberInput.addEventListener('input', handleInputChange);
            checkButton.addEventListener('click', handleCheck);

            // Set an initial valid value and trigger updates to show it works.
            cardNumberInput.value = '4300111122223331';
            handleInputChange();
        };
        
        initialize();
    });
  </script>
</body>
</html>